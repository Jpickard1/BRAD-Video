thank you for introducing me and for having me here presenting my work so today I'm going to present a Staal method that we have developed called base uh can people in the back here okay I'll do my best so uh the name of our method code base and it's uh developed to perform a multiscale multi sample analysis in spatial transcriptomics data uh the two tasks our method is dealing with are the cell clustering and spatial domain detection in the context of spatial transomics so uh here is a a little bit background for special transatomic Technologies special Tech special transic technology is a collection of many different methods that have been developed recent years to collect two important information in a biological tissue the first important information is the GPR information or how actively a gene is going through the transcription and producing protein in uh in cell and the second important information is the special location information so that we know where the um expression is happening in the cell and actually many of these technologies have been commercialized for example the merish has been Comm commercialized by vam Cosmic Byam Dum by T genomics and these Technologies can roughly be uh categories categorized into two groups uh according to their uh Tech according to their technique so some techniques are based on the sequencing technology including the VZ and S and high definition special transcri scope um and these Technologies so different groups of technology has different features than for Technologies in this school they usually have very high through boot which means they can measure almost almost all the genes uh in cell but usually the special resolution for this Technologies are relative low which means uh for each special location it usually contains multiple cells it's not like cell resolution or even subcell resolution and the other group of Technologies are based on the single molecule fish fish technique and this uh technique these Technologies include the merish danan cosmics and and important feature of these Technologies is that they they're based on they're using microscope microscope so they can basically see the molecules under the microscope so the resolution is under um Subs level however disadvantage of this group methods that they can only measure like a few a few hundred genes because they are targeting those genes specifically so give to to to give you a sense like how these data are collected uh how they are generated by the experiments uh here I will uh um give you two examples one each category to show you like how this uh data is generated so this is a a very popular uh data called Popular Tech special transcriptomic data called TX genomics this is commercialized by visian so uh uh at the beginning you have a So-Cal V and special expression slide and within this slide you have four different capturing area and within each capturing area you can you can basically take a slice of your tissue sample and place the tissue sample onto the um caption area to measure the spal transcriptomic data So within each captioning area we have a lot of these uh spots and within each spots is coated with a lot of primaries and this primary is basically a sequence of nuclear tier uh have different function units for example this poly ttail is designed to pair with a poly a tail uh in the Mr so it can it allows the primer to capture mras and also has AI component uh the Umi stands for Unique molecular identifier and it's designed to debias the PCR procedure and another important component is the spal barcode so after sequencing this you can essentially know where this primer come from on this uh cap area so this allows us to measure the special location information in this data set and another group methods are based on the uh fish technology I'll uh here is an example this technology is called merish commercialized by V dream and so the idea of single molecule fish is basically we have a have a have a pro it's a it's a basic sequence of nucle Hees and it's designed to Target specific transcripts and in this in this Pro is tacked with some uh fluorescent molecules so after some uh trigger you can actually see the color under the microscope but the traditional SM fish technology they can only target a few uh jeans so this smfish technology extend this traditional fish technology and do a series around of exertion hybridization of the props onto the molecules so at each round some of the uh genes will be uh you can see some of genes and it's coded to be one and for those genes that cannot be see is coded to be zero and after a lot of runs you have a basic barcode for each specific Gene so these barod are Prett specified before experiment so you can basically use the barcode to uh to identify which which molecule which dream molecule belongs to and then directly count the number of the of the molecules as the Gen verion data and for the location information you can basically just see under the microscope so no matter which technology is used to generate the special transcriptomics data it basically gives us two matrices one is the G expression matrix it's a p by matrix for cells and P and another important uh Matrix is the n by2 location Matrix for Nells and X and Y spatial coordinates on tissue and for some specific technology such as the Starmap it can measure the GPR in 3D so it also has a third dimension and with these two important data we can perform many interesting analysis and uh two specific uh questions that of interest to many biologist are cell type inference and spatial domain detection and we Define a cell type to be a cell that has a unique cell uh gene expression profile and we Define special domains to be a region on the tissue that has a unique cell type compositions uh here uh I will use this synthetic cortex data to uh give you example like what our cell Ty look like and what our special domain look like so in this syntax cortex it has the different cell types so we have accessory neurons inhibitory neurons and different types of non neuronal gleo cells denoted by different shapes and colors and besides these uh different besides these uh different cell typs we also have four different spatial domains we uh in our uh in this context because this is this is cortex so they are usually called layers and we have layer one all the way to layer four and we can find that in each layer we have different composition of cell types uh many methods have been developed to solve these two important questions but they Unfortunately they all have certain limitations and the first limitation that they they focus on either one of the two tasks they either do a cell type cling or they do a special domain detection however just like I mentioned these two tasks are they are interconnected in each other like if we know a cell the special domain a cell belongs to because the special domain has has a specific cell type composition we can essentially use this composition as an information to help us improve the influence of the cell type and on the other hand for the spatial domain detection essentially the cell types are defining the spatial domains and the other limitation is that uh most of these existing methods they only analyze one tissue section at a time however for a typical special transcriptomic study we usually take a like a series of cut in uh in the tissue uh we for example here uh is a brain is a mus brain and we we we usually take a consecu consecutive card of the green tissue and measure each of the slides tissue and so in the end we will have multiple tissue sections and in in some in certain cases this is a different uh uh T sections are measured in different subjects like in different Mouse uh but in the same tissue type so no matter it's measured in the same uh same subject or different subjects of the same type they all they are supposed to have they supposed to have similar cell type composition and special domain special domains so we can essentially uh leverage this information across these multiple tissue sections to help us improve these two analysis and the third uh aspect is more on a technical aspect so most of the special domain detection method they uh they specify a key spal parameter and they use this parameter to um to encourage smoothness across the spal domain because we assume the special Dom are that's Mo um however they all these me they pre-specify this value or they just as rely on the user to specify the value but actually the the final results of the spal domain detection can be very sensitive to to the parameter we specified so for example when the parameter is zero basically there's no smoothness you can see the segmented spal demands are very Massy and if it's too large you tend to over smooth certain domains only when it's in a within a optimal range we can have very uh good segmentation of the special domains so given these two uh given these mations uh we are we have developed method called B which stands for Bion analysis for spal segmentation that can perform multiscale modeling so we infer cell types at a singular single cell level and detect special demands at the regional level within a same herac model framework and another feature is that we can do M multi sample modeling so that means we are joint the modeling multiple tiue sects together and finally we can infert the key spatial parameter Based on data at hand uh so next I will introduce our method so our method take two input data our method assume there are like capital L different tissue sections collected from a transcript transcriptomic uh study and we use lowercase L to denote the one specific tissue section and for each tissue section we have a expression Matrix which is p by NL Matrix for PG NL cells and the special location Matrix and in addition to these two input Matrix uh we also assume that for each cell we have they have for for cells they have two hidden States so uh each cell has a cell type label Cil and also have a special uh special domain label Z and the goal of our method is really to use these two input data to to infer these two hidden states of cells and we do so uh based on a hierarchical model so uh so we we link the four components the G expression cell type and spatial domain location information within a Bion Hier framework and on the outermost layer we have G expression and depending on the expression of that g we can infert the cell type uh in expression profile of the cell we can inert cell type and then once we know the distribution of the cell types we can know we can infert the spatial domains and finally we have the location information here to encourage smoothness and incorporate neighborhood similarity across the special locations U and we next time we'll introduce like what type of models we use to model each of the relationship within this High model so we use a multivar normal distribution to model the expression features so depending on the specific cell type the cell belongs to the gene expression features follow a multi normal distribution which meaning mean parameter muc and variance parameter Sigma and we notice that uh we know that this mean parameter is C specific but this variance component uh this variance parameter is um is shared across different cell types and reason is that we usually found that for some cell types the the number of cells is relatively small so it's it's very hard to have an accurate estimation of this variance compon this variance parameter so we decide to uh impose a uh this constraint that let them be Shar across different cell types to have a better estimation um and given the specific special domain the cell belongs to we assume that the cell type of the cell follows a categorical distribution uh with a parameter Vector Pi p r uh here p r the vector of probabilities of of different cell types in that specific special domain are and finally we use a homogeneous part model uh to incorporate neighborhood similarity and encourage smoothness across special Dom and these three models essentially link the four components such insiration C Ty special domain and location information together uh this way the influence of the cell type special special domain can be like connected against and end up helping us to improve the effectiveness of both of these analysis so here uh is a little bit uh introduction to the P model so P model is commonly used in Vision analysis at the prior to uh to incorporate the relationship among variables and it has two uh uh parameters one is a neighborhood graph uh with this this graph is basically tells you like like what cells are the neighbor of one of each cell and we construct this neighbor graph using the special location matrix by searching for each for each cell the K nearest neighbors and another important parameter like I described before it's a spatial interaction parameter that controls the smoothness across neighboring locations um so the model and the algorithm based on the Bion framework so we basically follow the standard Vision inference framework we use the GI sampling and Metropolis ttings algorithm algorithm to iner to sample all the parameters from their U for conditional distributions um but in this process uh because we want we also want to sample beta and to infer finally infer beta and but this this c c of beta is a normalizing constant in this C model it makes it really hard to evaluate is this probability because it require us to evaluate uh all the conf the configuration of the stal domains in order to get the normalizing constant so we end up using an algorithm for algorithm and allows us to like sample beta more efficiently and it also allows for a f mixing rate which means the the the sample the the the samples are less correlated each other so in the end we would have three output one is the cell type cluster labels and the second one is special domain labels and finally we have the cell type compositions within each spatial domain and this is a basically our method and next I'll move on to the result section before I do that I any questions do you get the ground label can you speak a little bit uh how do you get a ground lab we we don't it's a cling so it's unsupervised it doesn't need want so you still need to evaluate the performance uh we evaluated them in simulations so we know the truth there no real we do have real data we do have some real data and you can look at an an of those of those tissues to like whether that's sense to see that [Music] sense for real data can real dat we don't have the truth in real data analysis yes so with the uh like smoothness parameter um is that there because there's an assumption that there's like an error in determining like cell locations or is that there just to like like reorganize like the cell types into like specific places oh because the interaction parameter is here because we want the like the neighboring cells if they are located near each other we want them to belong to the same special domain that's just basically allows her to incorporate this information into the model okay probably expression why distrib like distribution [Music] or multi distribution are you think of T distribution or distribution the question is why most normal distribution model expression dat as oppos to another oh we we normalize the data so it's it's more normally behaved it's not counted that's your question so um so next I'll move on to the results section and talk about our some of our simulation real dat application results so uh so so here is a brief introduction to our simulation design so we used the real spatial locations of 1,127 cells from the M CeX stadium and we assign these cells to four different spatial domains uh just like the show at the bottom we have assigned cells into the layer one layer two three layer five and layer B and we also in addition to these four special domains we also assume there are four cell types with different special distribution patterns and for each special domain we assume there are three cell types and if we compare two domains we have one unique uh each special domain has one unique cell type and have two cell types that are in common and we assume these cell types have different spal distribution patterns uh we designed a total of four scenarios uh in the scenario one where the cell type has a strong strongest special distribution that means each special domain is basically dominated by one C Ty and in uh scenarios two and three uh the proportions of the dominant cell types are either 80% or 50% and the proportions of the other non-dominant cell Ty are 10% and 25% uh and in scenario four we assume it's it's a cell type has the weakest special distribution p and each cell and each cell type uh is located in three different special domains uh and in so uh so this is a simulation result for special demand detection and we compared our method base to three other commonly used special Dom detction methods the HM b space and STC uh because HMI requires the user to specify the special parameter so basically what what what we did is we um we specified a list of different data values and fit the model and and reported the results that give us to the worst media and better results for for better comparison uh and we evaluated the uh the accuracy using the adjusted random index so this index ranges from 0 to one and the higher value indicates a better accuracy and we can find here uh our method has overall the best performance and it's followed by HR hmrf SP GC and the b space and we can also notice that in scenarios one and two the performance of of our method is very similar to uh the other methods and this is because in these scenarios uh the spatial dist uh the spal distribtion pattern of cell types are very strong so for each special domain it's mainly composed of just one cell type so so for those cell types that directly modeled the special domain and don't consider a cell types they can also have very good performance however when in scen uh when it comes to scenario three and scenario four where each special domain is comp composed of more different cell types the performance of the other methods become worse um and for cell clustering uh we compared our method with uh three other method the sd3 is red and picked and and our method has overall the best performance and it's followed by sc3 ser and fix and uh one observation we can have here is that the performance gain from our method compared to the other three method is the largest in scenario one and this is because in scenario one the spal the cell type has the strongest special distribution pattern so it can benefit more from the the special domain information that's why it has a uh have a larger performance scin however when the special distribution pattern of self has become weaker and weaker the performance G also gets weaker and besides the the S single sample analysis we also do we also did a multi sample analysis by analyzing by Joly analyzing multiple tissue sections together so as you'd expected if we increase the number of tissue sections the performance uh of the special domain detection increases and the performance of power method and CET increases for cell type uh clustering as expected however for S3 the performance increases first and then it decreases basically uh it's because uh sc3 cannot handle very large data set and when the number of cells exceeds uh certain value it the performance just decreases and similar observation we can make here is in scenario when the performance gain is much larger compared to the other two and this is because cell type has the strongest special distribution pattern and the performance SC decreases as the uh special distribution pattern of cell Ty decreases so uh when many uh people come want to use our packages come to us the commonly asked question is that how to specify the number of special demands and how to specify the number of cell types and I think that's a common question for many like clro methods so we did did uh we did a sensitivity analysis and evaluated like if we specify a wrong number of special domains how this would change the performance of our method so in our simulation the true number of spatial domain is four and uh here along the AIS it's the specifi number of uh speciaal domains and on on the Y is it's showing the proportion of cells in each of the segmented domains so as expected if we under specify the number of special domain we end up only just having uh two clusters and of course U many of domains will be segmented into the same domain and if we overp specify the number of special domains uh one interesting uh finding we we have here is that we still have uh largely four domains and the the remaining domains what we call redundant domains they only have very small number of cells in these domains but for the other methods like especially for b space it tend to split one special domain into multiple domains so you can see the number of celles in each domain is basically equally evenly distributed along among these uh class so this is very good feature of our method and similarly when we specify misspecify the number of cell types even though the uh total number of detected clusters is U is wrong is large but we can find that the proportion of cells in those redundant clusters are very small compared to the other methods so in general it's doing a very good job so given these results uh we have a practical guidance on selecting these number of special domains and number of cell types so we usually um tell our users to like overp specify the number so that if you you see like for special domain the number of cells very small so it's likely indicate that this domain is redundant so you don't need to that large number but it's kind of a little bit tricky for for selecting number of cell types so because sometimes if the number of cellp cells for of a specific cell type is small we don't know if that cluster is redundant or there are just real cell types so caution needs to be made when dealing with cell types we we need to like check the for example check expression or some maraging of those real those clusters that have very small number of cells to make sure that they are either real cell types or just you D clusters uh and these are basically the simulation results and I'll illustrate the one example using real data method performs there's a question online from Abdula who asked how does your method handle non single cell resolution data yeah it's a bit tricky to analyze non- single cell data we have one yes it's in my latest slide we did apply the our method to non single cell resolution data it's a tank vism data uh I think because it's non singular resolutions and each spot is composed of multiple cells so we no longer have the cell type resolution we we no longer have the cell type interpretation so when we analyze these type of data it's better to just focus on the special domain analysis um yeah so the real data we analyzed is from is a mouse hypothalamus data from the Mish technology and this uh region is responsible for controlling social behaviors such as reproduction and circadian rhythms uh and homeostatic functions such as the neural entering and cardiovascular regulation and we obtained a total of five tissue sections and each tissue section uh has around 6,000 single cells and around 155 uh M jeans because this is based on fish technology so you can only measure a small set of jeans and for each of the tissue section uh it has eight symmetric stal domains and as Illustrated here in by this uh H image we can find we can see the structures of these domains and this is from the mouse Alum bring analys so for a special domain detection we can find that our method did very good job at detecting all the eight symmetric special domains and if we compare our method to the other methods our method and hm hm they both detected very relatively smooth uh spal domains and that's because uh for hm we just a specify list of many different uh spatial parameters and pick the one that we feel is most reasonable and that but this result indicates that our method can estimate the spatial freter very well and in contrast the b space and SP gcn they can barely detect any smooth domains and this is because b space uh it cannot handle single cell resolution data it's mainly designed for uh uh T genomics those type of data TX genomic in and for SP gcn because it's preit by the special parer under and because it does not give us the very good value of the special parameter so it does not give us the good segmentation of the V and uh if if we incorporate all the ti section together it further improves the performance of the cell type of the spal domain detection uh as you can see here uh we from the brma negative .04 all the way to brma negative 24 this sections are collected from the anterior all the way to the posterior mpus so they are expected to have similar uh special domains and ZTA convs and indeed we find that the special domains detected by our method are very consistent ACR these side tissue sections and another important thing we find here is that we can actually detect the structural change uh across these tissue sections for example this PBT region on the top which is color by R the size of the region keeps increasing from the anterior all the way to the postor region of the most hypothalamus and this uh results cannot be found if we analyze one single tissue sample at a time for example here at for the BMA 0409 we cannot detect the PBT region which supposed to be colored by red on the top and for the this tissue section uh bre one9 we cannot detect the PV region which is both to be colored by light blue and suround the S ventricle here so this results highlight the importance of doing a multi sample analysis and integrate all this tissue section together this to perform the analysis um just like uh so another benefit of an accurate special domain detection is that we can use those labels to do uh uh Define markens to find domain Marin just like what we are doing in with cell types to find cell type Marin we can use the special domain labels from our method and perform a differential expression analysis to find those Mark and by associating these micro gen with these Special domains we can better understand the biology under these underlying these special domains here I'm giving uh two examples of the genes we of domain Mark genes we found so this uh slc1 1882 Gene it's a domain Mark gen we found that are differentially expressed in the Perri hamic nucleus and this Gene Calles A transmembrane protein that regulates dopamine and we know that inhibitory effects of dopamine uh dopamine has inhibitory effects on the gan gan troping secretion and this G troping is a type of hormone that triggers expression of two other hormones and those hormones they further act on the teses and ovaries and can uh have functions on the reproduction and so and according to some previous research uh this region is a well known for regulating the release of this ganin release form so even so our analysis actually indicat uh this Gene slc1 1882 might underline the function of the PB and another good example is that uh is this CCR Gene so this is the domain marker Gene for the media medial preoptic nucleus and the CCR includes a high Affinity receptor for the peptide hormone called Calon and the amaline calcitonin recept signaling has been reported in to mediate the affiliative social contacts so this is information we have about this Gene and at the same time we According to some previous study we know that this region has a regulatory function in reproductive and parental Behavior so now we can like associate so so this connection are suggesting that this function this stream might underline underline the the function of this region U so besides the special domain detection our methods can also do a good job in Z clustering so this is just uh a um plot from our method from and and we can find that for some uh cell types we canly put some neuron cell type properly identify them but C tend to like aggregate these cell types into the same clust and we checked the marking of these uh sub subtypes they do have very distinct uh uh markings so different cell types have different spatial distribution patterns so this is a slice uh so this the one slce from the mer data and this uh X access is the x coordinates and the Y AIS is the Y coordinates and in each plot we are showing the one specific cell type and we can find that with some cell typ there specifically enriched in certain region like this except to neuron five is reached in this PBT region but for some uh other cell types especially those non neuronal cells they tend to uh located across entire tissue such as the fal drid asides and and this plot the plot on the right is basically quantifying this observation uh for certain regions like the C ventricle U it's mainly dominated by one Stell which is the ATO cells but for most of the special domains it's it's a mixture of multiple different different cell types just like our assumption we we assume a special domain is composed of many different cell types and the enrichment of those cell types might underline the specific functions of those domains for example this BST uh is enriched with uh the inhibitory neurons and it's consistent with the previous study that this PST region project inhibit iers to the lateral hypothalamus and are important for feeding regulation and similarly this uh FX region or Columns of the phonic it's part of the limic system and enriched with Metro legal danger sites and this is also consistent with previous research that continuous oal danger Genesis in the FX is important for Mal lination and ensures rapid conduction of neuros sness so this slide is showing more of a technical aspect so this is showing the posterior estimate of of the spatial parameter so this in three different tissue types and we can find the uh the estimates are very different so so it does uh highlight it does highlight that the importance of estimating this brand here in different tissues in data sets instead of just fixing it to a specific value but uh and uh this is the computational performance so our method is colored in red and because it's a basion frame workor so the computational speed is not like super fast but the scalability the scalability is okay it scales linearly with respect to the sample size so for a data set with around 30,000 cells it takes about 50 minutes uh and these are basically all my real dat application results and uh in my lastly I want to briefly introduce our package so so this is the website of our package so our method is our software is an r package so the interface is in R but uh the underlying functions are written in C++ to in order to maximize this computation um so you can basically reproduce all the result all the simulation results and all all our findings in the in the real data uh in the in here so it has the introduction page software tutorial uh and all our simulation real data analysis results so uh in the Tut in the tutorial it has four steps in order to run our package so our uh software takes two inut data which is a count matrix it's a list of count matrices because we have a many different tissue sections and the list of special loation matrices and we also need to specify the number of cell types and special domains and then you create uh a base object with this input uh after that uh we pre we we only require only minimum uh pre-processing for the data so the basic pre-process steps include the uh Library SI normalization followed by log two transformation after adding a C count of one this is very standard pre-processing single cell data after that we select feature gen and perform Dimension reduction with PCA and we the default number of PCS to select is 20 uh because we are dealing with multiple tisue sections so we actually also perform the B effect adjustment with this existing package called Harmon so this uh this function called place. preprocess speciically automate this uh pre pre pre-processing step and if you want additional uh pre-processing or uh you don't like this preprocessing you can just replace the your pre uh processed Matrix with the running Matrix in our object and after that you basically run run the algorithm is just not too many options here and finally you Pro you have to Pro process all the posterior samples from the uh G sampling and Metropol testing algorithm and there are two uh questions uh problems we are going to addressing this uh postprocessing step why it's called label switching because uh for example if you are labeling cell type one cell type A to be one and cell type B to be two it's essentially the same to label them as two and one label cell type A to be two and label cell type B to be one so they they they have they essentially have the same posterior probability in the distribution so when you sample them they can they can form either of those uh called the PO mode so it it causes an issue when we try to summarize all these posterior samples because the labeling are not matched so we and this issue is called label switching issue so in this post processing step we used a package called T switching uh trying to address this issue and after that we just take the posterior mode of all our posterior samples as our estimates and that's basically uh the package and in summary we have developed method called base for multiscale and multi sample analysis of special transcriptomics and can perform cell T fostering at a single cell level and special domain detection at the tissue region scale with improved performance for po tasks and the paper has been already been published by gen biology here uh please feel free to check the details of the method and uh please also feel feel free to contact me if you have any questions uh the software is available at our lab website and with that I would like to thank my advisor Shon for his guidance on this project and than the audience for listening to my presentation thank you another question online for the FES applicable to vum data it's applicable one of our collaborators is actually applying uh F to to the data and the the results are quite good another questiones questions people online a moment in case anyone else typing well I don't see any other questions another thank [Music] you than everyone for coming and forward seeing everyone next week