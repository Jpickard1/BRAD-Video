at this time and it's just a venue to learn about and talk about new or not necessary even new just tools technologies methodologies and various stages of development some maybe are just in development others maybe have been around for a while but are used in some novel way and so just to have an opportunity to talk about these tools there is a sign-in sheet is hopefully floating around please do sign in it helps the pizza ensure that we have enough pizza for future weeks and with that I'm gonna actually let maureen introduce us so i'm happy to introduce my students raymond keval Conte he's been in my lab since what 2012 yeah so he is senior graduate students finishing up he has to first author publications so far in my lab and this is part of his third project we started developing annotate I shall always Raymond's idea because we saw a gap in it and then need a fairly simple conceptual idea but it kind of there was a gap that needed to be filled we thought and so that's what he's gonna be talking about today thank you all for coming so I was going to talk about a tool that I've been developing and that is pretty much a develop yeah and so I'm gonna tell you about a tool that I've been developing called annotator and the idea is it's going to help you interpret your genomic regions that you might have so kind of why would anybody want to do this the idea is we have a lot of data right if you do chip seek then you have a bunch of regions that represent transcription factor binding if you do bisulfite or RBS sequencing you might have a bunch of CPG sites and methylation associated with them if you do media for HP tip you have regions that are associated with methylation or if you do DNA's or a taxi can you move a bunch of regions with associated open chromatin and you don't want to just look at a table that gives you the locations of them you want to know where in the genome are they and what features do they intersect with and so you want to know you know does that transcription factor to find it promoters is that snip in an exon is the methylation lower in CPG Islands than it is compared to other regions is there an enhancer that has open chromatin around it also right so you want to kind of answer these questions to help interpret your data and maybe generate some hypotheses along the way so that's kind of why anybody might want to do this and so kind of as Maureen said the reason we want to do this is because we're developing DNA methylation analysis pipeline that we call mint and we have a bunch of data associated with that pipeline like cpgs with percent methylation and coverage information or differentially methylated regions with hyper or hypo methylated labels and then we also have a classifier that gives us a bunch of categorical labels for the regions and so we want to be able to interpret that data besides just staring at a large table with regions and labels and kind of as a side thing last fall when I started developing this with honey harbor we were both taking BIOS at 6:15 so I needed a project and this was kind of a perfect little thing that took up a whole semester so there are a variety of existing tools that kind of deal with this problem but we found that we didn't really like any of them so one one that we found early on and that seems to be used by a lot of people is chip igano which is an r package and so one of the problems that we had with it was it's pretty slow and I'll get to that later another problem is that it imposes a prioritization on the annotations so since the region is in a promoter and a CPG Island it chooses for you or you could choose for yourself but nonetheless you're only restricted to one annotation for region and that's not realistic and you might want to know that it's both of them and we found that their visualization functions weren't particularly helpful for what we wanted to look at so this is an example of the pie chart that tells you kind of how the region falls inside of features but we wanted more information than that another option is homer and while I really enjoy their their logo and it is faster than she began oh it also has the problem of imposing the prioritization which were not - and it doesn't do visualizations we would have had to do it ourselves anyway so that's not really good and so the first thing that I implemented was ferment was using bed tools which is a really versatile and wonderful application and it has lots of uses so you might want to look into it I implemented something with bed tools in ggplot2 and it was kind of hacky and I had to go get the annotations myself and parse them and then I had to build the visualizations myself and I thought you know why don't I just generalize this and do everything in our and make a nice R package this gives me a chance to build in our package from scratch which I've never done and so it lets me play by my rules which I can't on it to mess around with so there are some goals for annotator we need to be able to read a variety of file types quickly right like you could have bed files or you could have whatever weird files Bismark outputs that aren't bed files or you might have something altogether different so we have to be flexible in terms of the type and the size of the file that we want to read in we also want to annotate to comment in custom Jun annotation types so we have a bunch of genic and CPG features for human and mouse genomes to start that are built into the package and we also have some custom annotation capabilities and we also like I mentioned a couple of times we want to return all of the intersections not just a prioritization so that you can have kind of the full context of where your regions are falling in the genome and then we want to summarize and plot over any of the categorical and numerical data that might be associated with your regions so the implementation is exactly along those lines right so where it's divided into modules that read files or data frames if you're already in an arm session annotates the region so genomic regions and then summarize and plots them along with their data and so from here on out I'm going to illustrate how annotator works by walking through in an example with particular data so I don't want to dwell too much on the biology of this example data but I just want to point out that it's differential hydroxy methylation data between two conditions or sorry not hydroxy just regular methylation using a tool that was developed in our lab called necklacing and so the state is particularly nice for illustrating annotators capabilities because it has a categorical data variable it has a bunch of numerical they data variables that we can kind of play with all of our visualizations summarization options and of course there are regions so that's great so so I guess it does it is worth mentioning some of these things so for example we're going to talk about the French on methylation status which can be non hyper or hypo and then we have numerical values like the difference in methylation between Group one and group two and then we have the individual group methylations in those regions right so we're going to play with those play with that data individualization so kind of the first thing that we want to do is we want to be able to read small files like maybe tens of thousands of gypsy Peaks that come in like narrow peak or broad peak if you get them straight from encode or we want to be able to read large files that have like millions at CPG sites like we're encountering with our mini pipeline and we want to be able to do that quickly and so instead of using the base our package I'm using reader which was developed by Headley with them and it's kind of an alternative to like data table and the F read or whatever that function is called so the reader package allows us to quickly and flexibly read any kind of file type we want in and then we're gonna store this genomic ranges because that's the continued data type and there's lots of optimized methods for it so this is kind of all kind of give you code snippets for how like your analysis would be coded to kind of demonstrate that it's not a lot of coding and it's so this is the function that reads the regions for the data that I showed you just in the previous slides so you can specify what the column names are and you're probably going to want to do that because you'll refer to them later in the visualization and summarization function and you can specify what kind of column types you want specifically you can kind of decide I don't want to read in these columns because I want to save myself time in space so that's kind of that's what allows you to read in kind of any type of file that you like so as an example right if we have some random max two Peaks narrow peak we're obviously interested in the locations of the regions we might care about the names and then we want to pull out the full change and the p-values right and so we named the columns accordingly and then we tell the read function which ones to skip by using a - it's just kind of I've inherited the syntax from the reader package so this kind of allows us to read in like I don't know like 25 million regions pretty quickly without having to yeah and so one of the other things is I didn't want people to have to mess with their files beforehand to conform to something that we wanted them to have because I didn't want to do that for everything in our pipeline so that I figured this was kind of the best split the difference option okay so after you read in on your data then you want to annotate it obviously so I'll go through kind of what annotations we have so there's a companion package called annotator data and it has human and mouse annotations for CPG related features and also for genic annotations and included our entre gene ID and symbols so you can easily search the results for that and then we have an enhancer annotation for hg19 and we want to add some more for mouse and maybe different annotations for enhancers because they're quite variable as you may well know so our CPG annotation is quite simple we just grab the CPG Islands from known genes and then we kind of build out into KB chunks and we make sure that none of the islands intersect the shores and none of the shores intersects the islands and so on so this is a partition of the genome so that's that's pretty simple but our genic annotations can get kind of complicated or you can keep it basic if you like right you can have promoters write prime utrs introns and exons and the three prime UTR or you can split up you know the introns and exons whether they occur in the five prime UTR the three prime UTR or the c.d.s if you're into that have to be and then we have the one to five KB absolute oh it means you can kind of increase the resolution of whether your regions intersect like in exile that's another 500 meter or just in a CVS that kind of thing if it's of interest to you so not picture it in this kind of complicated graphic is we included intron exon boundaries and those are defined as plus or minus 200 base pairs between or around the junctions and then we have the intergenic regions of course which are where there are no genic annotations so like I mentioned before we also support custom annotations so the function that does that is very similar to the read function except you can read in any number of custom annotations at the same time you just have to specify where they are and how they're structured in lists right so that's pretty basic so in this case these will carry on through to the figures and the summarizations that we see later so I've just grabbed some easy h2 peaks from geo into 8 7 8 and some cgn peaks from k562 from encode just to kind of give a flavor for what's possible you could include DNA speaks whatever you want so in order to annotate the regions I'm like I mentioned before we're using genomic ranges because it's really highly optimized in it's very fast and then we use some deep layer stuff to kind of collate all the results together so in order to do this really all you need to say is what annotations do you want to annotate to write and so instead of having to type out like CPG Island CPG Shores CPG shelves etc I made some little handy shortcuts right so you don't have to do all that typing so that's just a cute little feature so you give the list of what annotations you want you say where your what the regions are what the annotations aren't whether or not you want to end it ignore the string in case in this case we're going to ignore the strip so that's all it takes to annotate the regions so this is kind of the big table that maybe you don't want to look at so much and white we have the summarization and plot features so this is actually for but it raps so the whole point is the result of the annotation gives you information about the annotations like the annotation type where the annotations are and maybe the entre gene ID and symbol in case you want to search on that table and then in from all the information that comes with the data right so where the data is and all of its corresponding numerical and categorical stuff so you may want to interact with this table you may not it's up to you so I'll start talking about now the functions that kind of help you interpret the data beyond the annotation table so the annotate the summarize functions basically just give you more tables but they're smaller so a very obvious thing you might want to do is just how many regions do I have per annotation right so that's like a table function basically but I figured well why not just include it in the package so all you have to do is give at the table of the annotations and then it will give you the annotation types and how many there are it's very basic but you might be interested to know like how do they compare to like a background set of regions or like a random set of regions or something like that to figure out if like this 5653 is like special to the data or not so we included some function a function to let you create kind of a randomized set of regions based on your input data so it's length and chromosome matched if you want chromosome matched you probably do so in order to do that you just need to give it your regions what genome you have so you're not like jumping outside of the genome bounds and then this creates kind of a set of random regions and then you just need to annotate them again so whereas in this function we just gave it the annotated regions to figure out what that table looks like with the random regions you just give it both of them right and so you'll get a longer table it'll have an extra column that tells you information about how many there are in the data and then how many there are in the random regions so then you can kind of make an assessment about if that's abnormal or not [Music] okay so something else you might want to do is take a numerical column and look at how that value looks over the annotations for all of the regions that intersect that annotation so you can use the summarized numerical function by giving it the annotated regions of course and then telling it what column what categorical columns you want to group the regions by so in this case I want to group them by the annotation type in the annotation ID and then I want to do the summary and over the difference in methylation so what does this give us this tells us for each unique annotation type and ID how many regions intersect it and then what is the mean of that value what is this in the deviation of that value so that's just a way to look at your data like with respect to any grouping of categorical data that you want I found this to be kind of the mark obviously useful one and then something else you might want to do oh that was just the output I didn't know you're writing code all the time yeah cut it off two decimal places yeah I could do that right so the next kind of thing you might want to do is some just count how your regions fall by grouping among any kind of other categorical data right so you don't have numerical data necessarily so in this case I was interested in how does the differential methylation status how many regions of each differential methylation status type are in each annotation type right so split it by split the annotations by a certain categorical variable so this is kind of what that gives you so you can do numerical summarization or categorical summarization it's kind of those two functions so I've also included a bunch of plot functions and so for these ones since the code doesn't fit with the plot on the same slide I'll kind of show you the code and then show you the plot so again you might want to know how many regions are there per annotation type and so there's a function called plot annotation that gives you a bar graph which we'll see in the next slide so basically you need to give it your annotated regions what order do you want the annotations to occur in you don't have to give it this but you can if you want and this vector also serves as a subset function so you don't have to give it all of them you can give it some of them and so when you do that you get you know just a regular old bar graph that looks just like what that table would look like if you needed a bar graph and again if you want it to look at what it looked like with random regions which I would argue is probably more interesting you just need to add to the random regions right and so then you get a dodged bar plot that maybe in this example tells you oh there's a lot more regions in my data that are in enhancers than I would expect from the background or maybe there's less intergenic in my data than I would expect verses background you know very basic stuff so another kind of thing you can do is you can do plots of numerical data a single numerical data column over kind of any facet so I've kind of imported that ggplot2 language here a little bit so you can tell it to show you all of the methylation the distribution of the methylation in group 0 over all the different annotation types right and so this is what that looks like and so we have the group 0 methylation rates in each of the regions that fall into the different annotations right and so the gray bars are the distribution for the regions that are in that particular facet whereas the outlined red bars are kind of the overall distribution so in this example you can see that promoters look like they're Burma are hypo methylated or as maybe the intergenic are the three prime Chiara seem to be a little more methylated than background so depending on what your data looks like this might be more interesting or less interesting I dunno so you can also add another numerical column to the very same function x and y and you can just have a scatter plot that's basically the same thing right so in this case I'm comparing group zero methylation versus group 1 methylation over the different annotation types so you could also do like a volcano plot or something like that for like because like the annotations you could use it as a custom annotation yeah it depends on how detailed you want it if you just want like the gene body then you could just use the start stop and the GTF well but if you want like the exons and stuff Oh so there's on the previous slide where I showed you how to read in the custom annotations you could just give the GTF file and specify which columns you wanted to grab out of it and then that would be like one annotation you would set set it beforehand and then that would be like one of the facets like your existing genes or whatever yeah that's a good point okay so you can kind of plot numerical data over a single column or over two columns if you like depending on what kind of data you have so you might also be interested to know how do regions how are regions Co annotated and so I've created a function called plot Co annotations that looks for exactly that and gives you a heat map so the function is quite simple and you give it your annotated regions like all the other ones and what you want them to be in and you get a heat map that tells you okay well for example I have maybe 163 intronic enhancers or I have 1900 CPG Islands that follow it forever right so you might be interested in particularly those regions so you can based on this and the numbers that you get you can go sups at that table or if you're interested you can plot numerical data over those connotations so you could say I want to look at the methylation rate in group 0 over the annotations of CPG Islands and promoters and what you'll get is a multi-faceted histogram that tells you where the gray bar in this case this is all of the regions that are just CPG Islands all of the regions that are just promoters and then all other regions that are both CPG Islands and promoters so you can kind of see the difference between whether it's important that it's in both or not right so in this case you see that maybe there's some more hypo methylation in this group when it's both annotations as opposed to either one individually okay so that's kind of all of the numerical data stuff so then there's just a couple more functions to do categorical things so you might be interested in splitting your regions by whether they're hyper or hypo methylated and then within both of those you might want to know how is how are the annotations distributed so this is a categorical plot and where you tell it okay I want to split it up by the differential methylation status on the x-axis and then I want to fill those bars with the annotation type and so this is exactly what you get right so this is the distribution of all of the different tests all of the sites that I tested for differential methylation how they fall into the annotations and then this is the number of hyper methylated regions and hypo methylated regions also split out among the annotations but obviously those are a little squished and you can't really figure out what's going on there necessarily other than to say oh it looks like there's a lot of CPG Islands so you might want to do the same thing except to replace this position parameter with fill so that it gives you the proportions instead and so you can kind of see immediately that in the hypermethylated there's a lot more regions occurring in the CPG islands and Shores versus kind of what I would say the background is or even versus the hypo or as hypo methylation is occurring more intergenic regions or inter cgi regions alright so this gives you an idea of kind of how your data is behaving and this function is flexible in that you can give it you can put any of the to any categorical columns in the X or the film right so I could flip the differential methylation status and the annotation type and end up with a plot that tells me what is the relative hyper and hypo methylation in each of the annotations and maybe you like looking at it this way better than the other way and it's up to you so you can kind of see that it looks like there's a lot more hyper methylation in enhancers in this relative to all of the regions and verses kind of some of the others and so on and so forth so those are kind of all of the summarization plotting annotation all that kind of stuff that's kind of the meat of the package and so I went ahead and benchmarked this against chippy ya know so when I said chip econo was slow I meant this slow so we compared chip igano and annotator from read into annotation because they don't do visualization so it's not fair and we used known gene annotations for both and then I gave it four different file sizes right small 27,000 33 and 65,000 all the way up to 25 million right and so blue Isha's chip began oh and red is annotator and you can see that for small ones it's like well what's 2 seconds but as you get larger the difference is quite startling so I'm hoping that this makes people want to use annotator or something like ship began out so I hope I've convinced you that annotator is pretty fast that it's rather flexible and that it's relatively easy to use with all the code snippets so if you happen to have genomic regions then you want to annotate them I'd really be happy if you used it and you get feedback and if you don't like features or you want to see certain features I more than happy to hear all about that so as far as where to get it right now it's on github the annotator data package and the annotator package both and you can install them using this simple command and Maureen was kind enough to let me submit this to the bio archive so if you don't know what the buy archive is it's like a preprint server for bioinformatics and other biology related manuscripts kind of like the physics archive right so we put this on the by are kind of needy in January and I was a while ago yeah and we're gonna submit it to bioinformatics as an application note soon hopefully and I've submitted it to bioconductor and I'm kind of in the middle of negotiating what I want to change and what they want me to change so we'll see how long that takes so with that I'm happy to take any of your questions so Raymond some people here might be interested to know like how submitting a package to bioconductor has evolved and what you're going through now oh yeah so they've gotten a lot more stringent so you basically submit your repository over github to there as an issue and then they kind of look at it for like scientific content to make sure that it's not replicating other things and then they they kind of if you re implement anything that they've done in a package they really don't want you to do that anymore and so they they try to get you to use their infrastructure which sometimes is ok and sometimes ISM so yeah they're they're paying a lot more attention to the quality of your code and duplicating functionality and all of that kind of stuff which is good but a little frustrating sometimes but they were asking Raymond to add something Oh right so yeah they were they were complaining my little yeah they had complained that I made my own annotations when they have their annotation database but like they don't have CPG Islands for HD 38 so what am I gonna do yeah yeah so that was use I mean right but I don't think if I go and write yeah so I have a pretty detailed vignette I kind of step this is basically the vignette actually and then all of the manual pages are pretty filled out with examples and all of that kind of stuff I tried to be as thorough as possible great thanks so you depart the next stage of your career what kind of maintenance ever is required to keep this useful current so yeah so if we're gonna continue to do our own annotations then I would have to kind of rebuild the annotations for new genome versions as they become available right so that's one of the advantages of bioconductor telling me use our packages because that it's easier easier to update with any new genome just by calling their stuff so yeah I guess code base wise it's not too tough but it's the annotations that are what's really important and I guess it's keeping up with whatever package dependency changes occur I've already encountered some visualizations changing because of the underlying dependencies so it's not trivial I guess yeah it was really nice and excited to use it my question I guess is I like that you're being inclusive so you know every annotation doesn't override other annotations but I'm wondering if you put any and two during the reverse where Yusuf but I call more doing roll-ups on turn in terms if if I want to annotate by Jean and I don't want to have ten pieces of information associated with that Jean I want to sort of collapse things rather than yeah he thought about how to do that I guess one quick thing would be to just include an annotation that has the gene boundaries right so it's just the gene body itself from TSS to tes and that because it doesn't summarize oh you know the data associated with it I guess that's the problem right if you have readings in your methylation there's and down yeah yeah I guess you would yeah you would be you could use the summarize function and it would kind of figure out what the different methylation is over all of the regions in our second etching Bobby but you would I guess not get to see the distribution in the gene Bobby yeah that's just kind of the person s a bit more complicated excuse me I like that you include the ability to pull out of randomized background regions and my question is so do you have any functionality in there to perform like statistical tests against for enrichment against that background or even as simple as putting like error bars on your histogram no we didn't include any tests because we were kind of nervous that it wouldn't the same test won't be applicable in all cases so we didn't want to create this one-size-fits-all thing so I figured it's easier for me to just not do it so it's left to the user as an exercise develop a tool you want to be careful to create it so that it's not easy for the user to screw up face to it for them to get a biased results on the statistical test yeah and yeah we haven't been able to figure out a way to to be pretty sure that they want to do that second question related to the background is why do you just look at chromosome and length rather than including things like GC content yeah that's to a transcription start site so so under the hood we're using the region R package and you can get more fancy but kind of as the first implementation I just did the length and chromosome matching and we could conceivably add other parameters for like qualities that you want in your regions but yeah I recognize that's something people were points yes so mostly just GC and link to distance to TSS so I'm looking at regulatory elements so okay important variables yeah to actually sometimes have miniature pending action other they wouldn't read or to annotation sometimes what I have a patient's broad enough so you mean there could be like you if i zoom bodies mom I get to hypo or I have this island shortened ocean I might get some sense not meeting summarized discordant data kind of questions more general wondering yeah it depends on the context what you do but Raymond can see specifically what the plots do in that case Dorsett visualization annotation of algorithm lies what do people or advance you like yeah yeah so it's tricky when you're comparing across regions like there's there's one specific paper you remember that Oh lira pocketer and his student about the Simpsons paradox is that right yeah yeah we can talk about that yeah that often happens that in a region there's both hyper and hypo and slightly different regions within a region right so Mars we have three years been building up valuable tools in the old and civi website there's a listing in the DC MVCC ABI website there's a carry forward and listening it might be a good session in this series some time to actually put upitis to the list and ask the people most knowledgeable but maybe not even most other but people who have used the tools if anyone has recently to describe the pluses and minuses and what kinds of upgrades might not be immediately to keep them useful for ourselves and for others in general my impression is that in bioinformatics and many other fields people have developed new methods new tools I tend to use their own occasionally they can pair with others as marinas demonstrated very nicely paper on constant tune but the performance across our colleagues are all around the community is not great for using learning to use and properly using multiple tools in general if there are two or four alternative tools their current some have this advantage and that limitation the different management different limitation and being aware of when they might be useful when it actually might make a biological finding more robust to show that you get the same key result for two or more different tools given their differences so that might make an interesting session or more than one taking and I think bringing everybody in this room and your colleagues throughout the program up to speed on what we have done and what we have available it's all available to you and most case there's somebody still here who could help you use whatever sounds potentially valuable [Applause] [Music]