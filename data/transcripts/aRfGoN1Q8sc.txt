creig's I think you've all been here before so I don't need to give much of an introduction we'll pass around the sign-in sheet if you haven't signed it please do so this goes you know it's pretty obvious for there's no tools in tech seminar next week because of Thanksgiving so we will the next session our speaker will be the week after Thanksgiving but that I can just introduce our speaker today we have Andy Kahn there's a grad student in DC I would be hi I'm Annie from Alexia Space Lab and so we do lots of and today I'll be talking about a new database search tool called Emma's Fragger that will enable us to really study lots of chemical and biological modifications and proteins so just to give some background on you know shotgun proteomics so the shotgun proteomics at least you know well I guess there is only enough speculation I can for the proteomics you know we start off with some biological sample of proteins and we want to analyze it using a mask I can get some you know sets of peptides from which we can you know identify proteins from and the basic workflow we start from Santo you digests into peptides often using trypsin and then we can deplete are enriched for certain things so if we're interest again phosphorylation we can do fossil in Richmond and then we separate up the Sampo using HPLC and then we feed it into the mass spec so and obviously fractionation is a very important parts of sample preparation because the sample is just very very complex and a mass spec it's not able to know sample everything fast enough so now you can run your proteins on a gel and separate things out have a protein level before it getting it digest or you can die chats and separate things out using these simple column so I can you can separate things out using HP LC and then you mix your samples again so there's a lot of things that you can do with my fascination and after you load your peptides onto LC system it gets separated over time and that's a particular time those peptides are ionized by the mass spec and they're measured item s flex so this is a sample survey skin so it's just a measure of what peptide ions are coming into magenta to mass spec that's a particular time so we can stack the scan so so this is what it looks like so this is very soon Dan we're looking a very narrow range of nasty charges and this is in retention time so this is from 33 minutes to around 37 minutes that's around 650 and we'll proceed to you know six six seven so it's relatively narrow and I just want to show you know what the data looks like so here we have my eye on coming off there chromatography so at first you get a like signo and it intensifies and then it's done so these are just peptides coming off of the chromatography being ionized and measured by the mass spec but just a mass of the peptide eye on you know we can't identify a peptide from that because you know you have all these isomers and there's a limitation till accuracy we can measure the mass of these things so get in shock and proteomics we do something called data dependent acquisition so we tow the instrument to say well if you see something interesting if you see some intense pepper ion isolates it we only want to look at that and then we fragment by hitting it with some you know in there it's gas so that peptide will fragment and so a fragment along its backbone and using current instruments we mostly get Y and B ions so this is the workflow so peptides come off liquor chromatography into the mass spec the mass spec says oh this is interesting as fragments a fragment said and then we get F recommendation spectra and from this fragmentation spectrum we try to identify what the peptide is so there are different strategies for doing this first and most popular database search for we going to the sequence database and we digest we do an incircle digest of that database we generate theoretical spectrum for all of these peptides and I mean try and compare these theoretical spectra to the kind of mass spectrum that we acquired so after the same thing then they should look alike so there are also other methods which are less popular but they offer a lot more flexibility so can sequence tag based approaches to software which try to look for these differences in mass spectrum that corresponds to particular amino acids and so you can and then used as a filter in your sequence database so this allows for some potential you know single amino acid variations and other things or you can go with de novo sequencing where the software just tries to interprets the entire spectrum without a sequence database and you know those methods are obviously much more noisy and calm patiently intensive that a simple database searched which has been around for probably two and a half decades now so just so ms Fragger is the database search - so I just want to give you know a bit more details as to how they work so we have a measured path I own mass remember the instrument as a surveys all of these ions coming into English into the instrument and there was the mass of that had that ion and in a fragment and we get that fragmentation spectrum so that they be so the database search tool would take the measured pepper ion mass and use that as a filter when it assesses the sequence database and considered all these candidate peptides so if I measure a massive say a thousand and the mass accuracy of the instrument is you know plus or minus 25 and I only select candidates from 99.5 to your thousand point five and that really helps you narrow down with that peptide could be and then it would find correlates and compare and get some sort of scored that represents how closely the to spectrum are alike and then you can do some sort of statistics on it to tell you how good of a match that is so there are lots of - suppose this OC class mascot you know they've been around for a very very long time door proprietary commercial and enters a lots of you know open source and free tools like Thomas M Ashiya + Murray magic homesite dromeda and then computers used to be slower so this process used to take a long time but there are people who try to optimize things a P fine tied tempest that uses graphics cards and you know they all differ in your scoring functions have a computer statistics and how they're implemented and that you know they're all just matching these fragmentations back to a TV subscribe for spectra and it's all recently fast with modern computers thanks minutes or 10 minutes per file and in my opinion they're all of similar quality I know there are people who will strongly disagree and was I just - is the best to ever but you my experienced all similar in a large-scale experiment they all give you pretty much the same number of identifications that's a fixed air raids they differ by a few percent so okay seems reasonable all these true is spread pretty well afford confessional we're close and behaved similarly so why did I develop another tool Oh obviously it's for unconventional workflows so there's us think how mask tolerant search it's been around for a very long time but people then really use it because the instruments for instance accurate is back in the days and so the results that you were getting with masculine search weren't that you know powerful so get a mass spec experiment using these standard you know tools and databases most of the spectra that you're acquire remains unmatched so it used to be really bad for you only match maybe 10 or 20 percent and now with these better instruments we match a lot more maybe on the order of 35 40 percent but most of the spectra we don't match we don't know what they are when we look at some of them they look good but we just don't know what they are so in this paper they did mask how and search so instead of using a parameter purposely filter down the list of peptide candidates so the accuracy of the interim maybe five parts per million is that okay well let's pretty much not use that information and let's use a window of $500 to allow for all these Annika or potential modifications and the idea behind us is that even though for matching these modified spectra to the unmodified Cerreta code spectrum so a lot of the fragments will remain the same and this is how they match and with high mass accuracy the idea is that your noise at the background is sufficiently low that you can allow for this not very restrictive matching and magically you know this identifies 30 to 40% more spectra so we're getting so we're going from like 35% - 50 50 5% so this is pretty big and you know we're observing all of these modified peptides that we don't we don't consider or don't look for them and now we're seeing all of them yeah tamo ones and lots of unknown ones and it's simple so you don't need all these specialized blind PD and tools so they're true us out there that would look for these PDMS but you know they don't really fits well in the context of these generic Burke flows where you know you have very good methods develop to estimate errors and all this other stuff so you know of those specialized tools you run it it generates a specialized format and it can really do a lots of analysis and it's not really compatible with a lot of different things so this is very simple you just change the setting and your favorite tool and presto you identify all these modified peptides so we're excited but we're not surprised that it works I mean it was done a long time ago and we actually did something similar using another database search tool that I develop that uses a GPU and he's and it we did something a bit more sophisticated with that and you see a very similar profile when we compared it to a blind modification tool so and we do lots of large-scale reanalysis in our lab so like there's some questions that we wanted to ask so are these modification rates preserve the cost of an experiment so come technical artifacts like oxidation or you know or even biological ones like phosphorylation are they similar in all these different experiments are there modifications are unique to particular experiments so we fired off our favorite search engines and in our lab we don't really use lots of the proprietary ones because they cost a lot of money and we want to just farm and outs on a lots of Linux clusters or a use Amazon Cloud or something so we generally use extended in comments so you ran one file and oh it took a hundred CPU hours you analyzed one run and we want to look at thousands of runs so no and in the paper they claimed they only took two hours under machine so we ran it on one of the computers in the pathology proteomics facility which actually has a proprietary software and it took 11 hours so unless so they could have some you know specialized modified version of the tool but we don't have access to it and we try to whole bunch of different tools and they all took a long time so we are ready to show the money you know clustered cloud computes but we started thinking so what's the fundamental problem so instead of comparing that one experimental spectrum to hundreds of theoretical spectra when we use that narrow filter for now comparing that one spectrum to potentially several hundred thousand or millions theoretical spectra so is there a way is there a better way of doing this and the answer is yes so for two spectra to be similar they must share some common fragments and we can get decks all of these theoretical spectra based on the masses of their fragment ions to quickly look things up that may be similar so this is just some more details common being within some mask tolerance and we want to just index all of these fragment ions so that you can quickly retrieve their parent um theoretical spectrum spectrum and we ordered references within each of these bins so that they're ordered by their current cookers mass so we can use binary search to quickly narrow down the range no fragments ever interested in so this is degenerate workflow in a this is the standard database search approach we digest the protein database enemy for each peptide we generate a little spectrum and then we compare that with reticle spectrum against the experimental spectra and in the MS Frager workflow we take the protein database and we generate a peptide index and that's been done before but we take a step further and we generate this retro fragment index from that peptide index and then we can simultaneously score one experimental spectrum against all threats factors and there's a lots of the efficiency that can be gained from doing this so you know whenever we develop a new two we have to make sure that the results that we get are correct and we see that be compared I'm a swagger takes 10 m2 comments to see class I'm freezing the sequence numbers that they published and the numbers are bit different from our FDR pipelines but you know are pretty much the same and then we also compared our results with mod a a blind ppm tool and you know we see very similar results but performance lies let me do a mass coloring search for 150 times faster than these conventional tools so extend them and but for clothes searches where we're using about 5 ppm windows so there's not much computation going on even for normal conventional tools that takes less than 2 minutes for that file no there's lots of overhead involved you could just starting up ms trigers so we take 24 seconds slightly faster but it's irrelevant but for masculine searches we're going from 14 hours 15 hours on no quad core a core workstation to 5 minutes and you can imagine if we want to do those thousands for thousands and thousands of runs it can make a huge difference and we also showed that the two scales very well there's a lot of optimization writing software engineering that went into just letting it scale if you have for a beefy machine and the reason why we gained all these performance benefits is that when in the confessional algorithm when you compare a spectrum to a spectrum once at the time that takes 200 operations back in MS Fragger when we do a mass tolerance search on average for each of these candidate peptides 5 so instead of a few hundred things that we're comparing we're only comparing 1.5 so that's why we get know about over a hundred times performance increase and we also did try a bunch of different things so now that we have our own engine we can build in certain things to explore this strategy so when we do a mass tolerance search we don't recover up we cover all of the peptides that we gets in the conventional search so we thought well maybe there's lots of noise let's try boosting some of these I modified peptides but it turns out that doesn't help and there's a very good explanation for this but I'm saving that for the beast or talk later in the afternoon and for fairly rare occasions when we do in a you know masked horns that open search you only get around 50% of the modified peptides so you don't get perfect recovery but we can also do you to search with these variable modifications because we can do searching so quickly that we do gain you know we get all of them back pretty much and because and your modem aspects we often only get by ions and it generated from the c-terminal end of the peptide so as you can imagine with this mass torrent search strategy for matching these experimental spectrum to unmodified threat across spectral spectra so in these cases you may disrupt the entire Y ion series so he added some complimentary ions to help recover some of these peptides that may have a C terminal modification and now you see that your benefits get slightly so going back here we do know the purpose of trying to look at these large-scale data sets with NASA for insurgents so we looked at the data from the paper dad I'm just mentioned I just mentioned um see McGee's sad it's a heck - ninety three cell line with 1.1 million spectra from twenty four runs and then we also looked at some larger data sets so some triple negative breast cancer data 20 million spectra and some here at around 3 million spectra and we also wanted to look at some label data so in theory omics people like to do labeling for quantitation and comparing different samples and there are some inherent challenges with analyzing that data using mass horn strategy because to analyze that data you also need to specify certain variable modifications and that can increase your search time by you know in this case force I like three to four times longer so we can imagine that if that one run takes 100 CPU hours you know their label data it may take 3 to 400 hours so when we look at all these modifications profiles we estimate that you'll take you know 60,000 CP hours to just analyze this data using Confessional tools and maybe 250,000 CPI hours for that 34 million spectra select datasets but using MS Fragger we can do this in a few days on a single workstation and we also do some math Massachusetts Lin and calibration because we're pooling all of these datasets together and the instrument calibration can be off by you know a tiny bit we want to make sure that everything is standardized so you have some calibration to that you know before we calibrate the data it's like this you can help the annotation apart from the first isotopic peak but afterwards you know you can see it to clear Peaks here so yeah so these are normalized modification rates so the Purple Line is the HeLa the brown line is the Heike 9-3 data and the green line is the triple negative breast cancers and we see that you know four cups common modifications such as among lots of ammonia or oxidation and phosphorylation there a significant difference between these profile these are experiments so the modification makes a very difference even though you don't expect them to be so a lot of this is likely due to you know all of that sample preparation so I mean I wouldn't expect the phosphorylation states to be pretty different from these different samples but yet they are different so there is something happening in sample perhaps that occurs how many of these things that were able to recover and then there are lots of other things that were you know just relatively unique to a particular dataset so for example this was not Anand annotated in Hoonah mod but we saw this mask 52.9 3 and just consulting a periodic table and seeing that it's associated with these charged amino acids we thought okay it's likely to be iron and then there are all these you know unknown cysteine modification so cysteine is just so reactive let me see you know in many cases unknown system modifications and then there are also these you know mass differences that are unique to a particular data sets but you know we don't really see evidence for that mass again the fragmentation spectrum so those are also very interesting and I'll talk more about them again the Beast will talk in the afternoon and we see that they there's not much difference new localization profiles of these different proteomes and and that's just to be expected and from our psylocke data comparison we compared you know the two different channels to lights and a heavy channel in psylocke data we have red being the data from the patient samples and the blue is just a mix of different cell lines and in this super silent makes we see this on distinct 30.0 one one you know patient samples that likely corresponds to this methyl oh that's that's commonly found in FFPE samples so ms burgers package you know as a standalone java program and they use the saudis common mass spec dania formats MGF Symes xml x ml and right skeptics mouth so it's compatible for lots of different workflows the papaya index is stored on disk so after you run it Rufus as if different because I have rameters the first time those safety Pepa index and a fragment index let's just generate it you know again memory when you run it and it can be reused when you're searching multiple runs so and what dynamically partition your fragment index to operates within how much memory you have so if you're interested in doing some gigantic searches I may know a few hundred gigabytes of memory and you don't have that Emmer's fogger will say ok well let me do this one chunk up first and I'll do the next chunk and I'm doing the next chunk and they'll combine everything together at the end to give you your final results so to run a Java starter and my swagger and I give a parameter file and then you give a list of data files and the configure and the parameter file is very similar to the one that you would use for comments and here I have a little video that would demonstrate what does so here my directory I have some program I have some data files I'm opening up the parameter files I'm just checking a few things this is on a twenty core workstation so so it doesn't have a peptide index so it has to build one so it's building the pepper index right now sorting these peptides merging and then generating all these modified peptides and then it writes the peptide indexed and when it says operating on slice that means generating the fragment index took four seconds and I was searching this file there read it end in 3.8 seconds and here it will updates every five seconds telling you you know how many spectra has analyzed those around 850 spectra is second right now and for you ship this these sum for each spectrum that's comparing it to you know probably close to a million candidates so you know when you see a thousand specs for a second it's doing a billion of these specimens spectrum comparisons of every second and so it just goes in an x-file it doesn't need to rebuild the index because how fat is and memory and you read the following at searching [Music] so searching these files using conventional tools will take several hours on the same workstations and here we see that it just takes a minute or so okay so it goes the next file but toda it's talk and then we see the pep XML ha outputs and we also see that pep index file where I store the peptide index and here's just Publix about file and when we run it again now that we have the peptide index it will skip off that generation you're just reading the peptide index and you know you know go straight to searching so in conclusion you know fragment indexing enables these super fast database search searches and as 150 times faster than a lot of these conventional tools there are no heuristics or simplifications and what we're doing here is just a more efficient data structure and so this allows you to do a large scale identification with all these you know put actually unknown modifications and it's you get close to 30% where PSMs you know typical shotgun experiments and you can investigate lots of different things the to itself is cross-platform java and compatible for a whole bunch of different formats and it does talk I mean events over to technical aspects of MS Fragger but we also did a lots of interesting applications using this too and we also applied the core algorithm to other things as well and I'll be talking about that in my piece to talk later this afternoon I like to thank the members of the lab and I'll be happy to take any questions all right put a new source database in there we'll check just notice that and make it an index yes so do you know the sense from using this tool how many of the unidentified spectra you're getting that are due to unknown post translational modifications versus maybe a non cryptic pregnant when it was supposed to be the mode so oftentimes when we see these non triptych fragments so it's from the source the case we get a cleavage from the n-terminus and that often results in a very negative mass and these very negative masses we do observe them in our profiles but it likely accounts for maybe less than 5% of all these other things so dominantly most of the things have positive masses and you know many of them are chemical modifications we haven't been able to follow up on a lot of these because they're just so many here and you know we're just starting to scratch the surface while these Oh all of these chemical modifications and previously in proteomics I don't think people had the capability to look at this on a very large scale and with this to me now can it seems like a fantastic event it obviously works and speeds it up in terms of validating that it's just benchmarking and goods to other algorithm said he taking something like a phosphorylation enriched sample make sure that all the modifications that you're detecting - addq - tax lots of foam phosphorylation events but so the mass tolerance perigee is not perfect because it matches things to the unmodified theoretical spectrum so you are going to lose lots of things unless we specified a modifications so it's a relatively crude approach that we still recover you know 30 percent more and there are potential refinements to the strategy where you can add in you know the mash of 2d fragmentation spectrum and you can modify the art from to you to do that but we haven't done that yet and you know we made gets another 10 20 percent no no because I'm sort of wondering so I guess you know do you have to have a dataset where that has been analyzed I mean I guess you know all for modifications yeah I don't think that exists so I mean there are lots of exotic and rare modifications in there so in their paper they reported this modification that's it that's us only found in this one transcription factor and versus one particular mass and no let me look at it look for this mass again much bigger data sets that you look at we see it and this mass only corresponds to this one particular peptide from that one particular transcription factor and they're likely you know thousands or tens of thousands of such instances that have never been documented before and you know we can start looking for some of these things now so when you the it's gonna build the index based on the parameters that you specified in your config file probably mass tolerance yeah so I think so that's actually specified as search time so the index is only dependent on know your protein database and your digestion parameters and after that's done and well and obviously all of their variable modifications that you want to specify but after that's done you know the index is the same so I can it uses the same index for 500,000 search or a 5 ppm search ok so that's not a factor so it doesn't matter which you said that it's only indexing based on the actual fragment yes so when you want to look at 5 ppm it just jumps to the right place and looks at the few fragments that's in there for us and a $500 thing that's you're looking through a much bigger slice [Music] yeah there's a lot that can be done with this and we're just at the starting point of trying to understand what all of these things are well these modifications are and it's exciting but we don't have the bandwidth to do all of that right now obviously that's excellent I'd be curious as to if so you know get a typical post translational modification again youit's best they would you look for peptides that have that mass modification certain amino acids but how many of those on the identified spectrum are due to that same modification but in some kind of weird fragmentation that you know it's some different mass from that I think that this type of thing would allow you to investigate you know how many inspector I'm missing that are phosphorylated that don't have that canonical - ad don't map yeah so we don't look for that on specific amino acids you know so this is one of the things we looked at when we look at these three when we look at these profiles so oxidation people generally specify that to be on Metheny but you know it's well known that it's also on tryptophan and tyrosine and all these other things but you see here but normally you just don't look for it oh I see so that's what the notice those are the amino acids yeah so first place shine is mostly on serine